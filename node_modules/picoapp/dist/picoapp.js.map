{"version":3,"file":"picoapp.js","sources":["../node_modules/evx/dist/evx.es.js","../index.js"],"sourcesContent":["var n=function(n){if(\"object\"!=typeof(t=n)||Array.isArray(t))throw\"state should be an object\";var t},t=function(n,t,e,c){return(r=n,r.reduce(function(n,t,e){return n.indexOf(t)>-1?n:n.concat(t)},[])).reduce(function(n,e){return n.concat(t[e]||[])},[]).map(function(n){return n(e,c)});var r},e=a(),c=e.on,r=e.emit,o=e.hydrate,u=e.getState;function a(e){void 0===e&&(e={});var c={};return{getState:function(){return Object.assign({},e)},hydrate:function(r){return n(r),Object.assign(e,r),function(){var n=[\"*\"].concat(Object.keys(r));t(n,c,e)}},on:function(n,t){return(n=[].concat(n)).map(function(n){return c[n]=(c[n]||[]).concat(t)}),function(){return n.map(function(n){return c[n].splice(c[n].indexOf(t),1)})}},emit:function(r,o,u){var a=(\"*\"===r?[]:[\"*\"]).concat(r);(o=\"function\"==typeof o?o(e):o)&&(n(o),Object.assign(e,o),a=a.concat(Object.keys(o))),t(a,c,e,u)}}}export{c as on,r as emit,o as hydrate,u as getState,a as create};\n//# sourceMappingURL=evx.es.js.map\n","import { create } from 'evx'\n\nconst isObj = v => typeof v === 'object' && !Array.isArray(v)\nconst isFn = v => typeof v === 'function'\n\n// make sure evx and picoapp don't destroy the same events\nexport function component (create) {\n  return function initialize (node, ctx) {\n    let subs = []\n    return {\n      subs,\n      unmount: create(node, {\n        ...ctx,\n        on: (evs, fn) => {\n          const u = ctx.on(evs, fn)\n          subs.push(u)\n          return u\n        }\n      }),\n      node\n    }\n  }\n}\n\nexport function picoapp (components = {}, initialState = {}, plugins = []) {\n  const evx = create(initialState)\n\n  let cache = []\n\n  return {\n    on: evx.on,\n    emit: evx.emit,\n    getState () {\n      return evx.getState()\n    },\n    add (index) {\n      if (!isObj(index)) throw 'components should be an object'\n      Object.assign(components, index)\n    },\n    use (fn) {\n      if (!isFn(fn)) throw 'plugins should be a function'\n      plugins.push(fn);\n    },\n    hydrate (data) {\n      return evx.hydrate(data)\n    },\n    mount (attrs = 'data-component') {\n      attrs = [].concat(attrs)\n\n      for (let a = 0; a < attrs.length; a++) {\n        const attr = attrs[a]\n        const nodes = [].slice.call(document.querySelectorAll('[' + attr + ']'))\n\n        while (nodes.length) {\n          const node = nodes.pop()\n          const modules = node.getAttribute(attr).split(/\\s/)\n\n          for (let m = 0; m < modules.length; m++) {\n            const comp = components[modules[m]]\n\n            if (comp) {\n              node.removeAttribute(attr) // so can't be bound twice\n\n              try {\n                const ext = plugins.reduce((res, fn) => {\n                  const obj = fn(node, evx)\n                  return isObj(obj) ? Object.assign(res, obj) : res\n                }, {})\n                const instance = comp(node, {...ext, ...evx})\n                isFn(instance.unmount) && cache.push(instance)\n              } catch (e) {\n                console.error(e)\n                evx.emit('error', {error: e})\n                evx.hydrate({ error: undefined })\n              }\n            }\n          }\n        }\n\n        evx.emit('mount')\n      }\n    },\n    unmount () {\n      for (let i = cache.length - 1; i > -1; i--) {\n        const { unmount, node, subs } = cache[i]\n\n        unmount(node)\n        subs.map(u => u())\n        cache.splice(i, 1)\n      }\n\n      evx.emit('unmount')\n    }\n  }\n}\n"],"names":["n","t","Array","isArray","e","c","r","reduce","indexOf","concat","map","a","getState","Object","assign","hydrate","keys","on","splice","emit","o","u","const","isObj","v","isFn","create","node","ctx","subs","unmount","evs","fn","push","components","initialState","plugins","evx","cache","add","index","use","data","mount","attrs","let","length","attr","nodes","slice","call","document","querySelectorAll","pop","modules","getAttribute","split","m","comp","removeAttribute","ext","res","obj","instance","console","error","undefined","i"],"mappings":"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"}